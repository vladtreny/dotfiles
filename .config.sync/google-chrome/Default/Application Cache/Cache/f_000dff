function H5b(a,b,c,d){var e=null;a.B.every(function(a,h,k){if(b&&(h>c||h==c&&k>=d))return!1;a.isEmpty()||(e=new N(k,h));return!0});return e}function I5b(a,b,c){var d=null;a.B.some(function(a,f,h){return(f>b||f==b&&h>c)&&!a.isEmpty()?(d=new N(h,f),!0):!1});return d}fM.prototype.cU=bS(169,function(a){var b=this.$.pp(this.C);po(b,"docs-icon-comment-blank-highlighted",a)});gM.prototype.cU=bS(168,function(a){var b=Ju(this.D);this.B.fg(function(c){var d=a&&c.iq().Sa()==b;c.cU(d)})});
hK.prototype.yta=bS(162,function(a,b,c,d){for(var e=a-1,f=this.C.length;0<=e;){var h=this.C[e--];if(!(h.getSheetType()!=b||h.F&&d))return h}if(!c)return null;for(e=f-1;e>=a;)if(c=this.C[e--],!(c.getSheetType()!=b||c.F&&d))return c;return null});xj.prototype.Bt=bS(32,function(){return!!Ph(this,"ip")});function J5b(a,b){var c=null;a.B.fg(function(a){a.iq().Sa()==b&&(c=a)});return c}function K5b(a,b){a.G.R=b;a.Tb&&a.C&&(R(a.C,0<b),hm(a.C.childNodes[1],b))}
function L5b(a,b,c){var d=0,e=-1;b&&(d=b.y,e=b.x);var f=null;return f=c?H5b(a,!!b,d,e):I5b(a,d,e)}function M5b(a,b){if(!b)return null;var c=null;a.B.some(function(a,e,f){a=a.fd();for(var h=0;h<a.length;h++)if(a[h]==b)return c=new N(f,e),!0;return!1});return c}function N5b(a){var b=new ag;a.B.forEach(function(a){a.isEmpty()||bg(b,a.fd())});return b.fd()}function o0(a){return a.B.hasUnpostedDocos()}function O5b(a,b){for(var c=[],d=0;d<b.length;d++)c.push(a.C.B[b[d]]||0);a.B.deleteDocoPositions(c)}
function P5b(a,b){var c={},d;for(d in b){var e=a.C.B[d]||0;if(e&&a.B.hasDoco(e)){var f=b[d];c[e]=new Docos.Point(f.x,f.y)}}return c}var Q5b={$Rb:1,HOVER:2,uKa:3};function p0(a,b,c){Uw.call(this,10100,b);this.$a=a;this.C=b;this.F=c}y(p0,Uw);p0.prototype.ue=p(35);p0.prototype.ke=function(){var a=new lw,b=mh(this.F,this.C);F(a,1,this.$a);F(a,2,b);return a};p0.prototype.rj=sf;function R5b(a){this.B={};if(a)for(var b in a)this.set(b,a[b])}R5b.prototype.get=function(a){if(!(a in this.B))throw Error("No value for key "+a);return this.B[a]};R5b.prototype.set=function(a,b){this.B[a]=b};function S5b(a){this.B=new R5b;this.C=a||null}S5b.prototype.Qc=function(a){try{var b=ui(a)}catch(c){return this.C&&this.C.log(Error("Invalid serialized anchor ID")),null}return this.B.get(b.type).Qc(b)};S5b.prototype.yb=function(a){return wi(this.B.get(a.getType()).yb(a))};function q0(a,b){this.D=a;this.C=b}q0.prototype.getType=g("D");function T5b(a){q0.call(this,"range",0);this.F=a}y(T5b,q0);T5b.prototype.B=g("F");function U5b(){}ja(U5b);U5b.prototype.Qc=function(a){return new T5b(a.range)};U5b.prototype.yb=function(a){var b={};b.type=a.getType();b.uid=a.C;b.range=a.B();return b};function r0(a,b){q0.call(this,"workbook-range",0);this.G=a;this.F=!!b}y(r0,q0);r0.prototype.B=g("G");function V5b(){}ja(V5b);V5b.prototype.Qc=function(a){return new r0(a.range)};V5b.prototype.yb=function(a){var b={};b.type=a.F?"range":"workbook-range";b.uid=a.C;b.range=a.B();return b};function s0(){S5b.call(this);var a=U5b.getInstance();this.B.set("range",a);a=V5b.getInstance();this.B.set("workbook-range",a)}y(s0,S5b);ja(s0);s0.prototype.Qc=function(a){a=s0.P.Qc.call(this,a);if(!a)return null;"range"==a.getType()&&(a=new r0(a.B(),!0));return a};function t0(a,b){if(!b)return null;var c=b.B();return"range"==b.getType()?(c=a.B[c],W5b(c)?c.jc().Be():null):(c=X5b(b))&&Y5b(Z5b(c))?Z5b(c).Be():null}function X5b(a){var b=new mi,c;try{c=ritz.getWorkbookRangeById(a.B(),!0)}catch(d){}return c?b.Qc((new Id).Y(),ritz.getWorkbookRangeById(a.B(),!0)):null}function Z5b(a){return new Sg(a.Ob(),a.Ab(),a.Fc(),a.Rc())}
function u0(a,b,c){return c?"range"==c.getType()?(b=b.B[c.B()],W5b(b)?(b=b.Nb(),null!=b?$5b(a,b):null):null):(b=X5b(c))&&Y5b(Z5b(b))?$5b(a,parseInt(b.Sa(),10)):null:null}function $5b(a,b){var c=Iz(a,b);return c?c.rc():null}function W5b(a){return!!a&&a.B&&Y5b(a.jc())}function Y5b(a){return!!a&&Bga(a)&&gh(a)};function a6b(a,b,c,d,e,f,h,k,l,m,n){G.call(this);this.C=a;this.xa=b;this.ea=c;this.Ha=d;this.J=e;this.Ia=f;this.Ba=h;this.Ca=k;this.B=l;this.R=m;this.G=b.Ha;this.D=b.B;this.F=b.M;this.K=s0.getInstance();this.T={};this.O=new ag;this.X=new vk(0);a=[this.X];Fb(n.C,a);Nxa(n,a);n.B=Lxa(n.C);Mxa(n);this.M=new M(this);I(this,this.M);b6b(this)}y(a6b,G);r=a6b.prototype;r.kga=!1;
function b6b(a){var b=mb(ABa,function(a){return!DBa[a]});a.M.L(a.Ha,"activity-box-closed",a.u4a).L(a.J,"mouseover",v0(a,a.ebb)).L(a.J,"click",v0(a,a.cbb)).L(a.J,"selectionChange",v0(a,a.fbb)).L(a.J,"inputBoxActivate",v0(a,a.abb)).L(a.J,"hide_docos",v0(a,a.dbb)).L(a.D,"Ta",v0(a,a.rsb)).L(a.Ba,"Ec",a.m9a).L(a.Ba,"Fc",a.k9a).L(a.Ba,"Gc",a.j9a).L(a.J,"insert_doco",a.osb).L(new zr(a.Ca),"mousewheel",a.psb).L(a.F,["add_named_range","delete_named_range"],a.f5a).L(a.xa,"docos_change",a.obb).L(a.R,"zf",a.sWa).L(a.D,
"Sa",a.zxa);var c=Nu(a.D);a.M.L(c,b,a.bbb);a.M.L(c,["Ib"],v0(a,a.qsb));DD(a.C,Docos.EventType.HOVER,v0(a,a.k_a));DD(a.C,Docos.EventType.SELECTED,v0(a,a.nsb));DD(a.C,Docos.EventType.CREATED,a.dwa,a);DD(a.C,Docos.EventType.UNRESOLVED,a.dwa,a);DD(a.C,Docos.EventType.DELETED,a.ewa,a);DD(a.C,Docos.EventType.RESOLVED,a.ewa,a);DD(a.C,Docos.EventType.POSTED,a.J_a,a);DD(a.C,Docos.EventType.PENDING,a.o6a,a);DD(a.C,Docos.EventType.HIGHLIGHT_INITIAL_DOCO,a.T1a,a);Z.Qo.$c(Tm,v(a.F2a,a));Q.ew.$c(Tm,v(a.cWa,a));
Q.z4.subscribe("action",v(a.S4a,a));Q.A4.subscribe("action",v(a.a5a,a));Q.B4.subscribe("action",v(a.b5a,a));a.zxa()}r.zxa=function(){var a=Ou(this.D);Q.z4.Fa(a);Q.A4.Fa(a);Q.B4.Fa(a)};r.F2a=function(){this.C.setOption(Docos.OptionName.READONLY,!this.xa.jD())};function v0(a,b){return v(function(a){this.kga||b.call(this,a)},a)}
r.osb=function(){var a=Pu(this.D),b=sv(a);if(b&&!o0(this.C)&&!c6b(this,a,b)){var c=ritz.getNewWorkbookRangeId();this.Ia.B(new p0(c,a.Nb(),Ug(b)));a=this.K.yb(new r0(c));if(a=w0(this,a))this.B.dispatchEvent(new x0("Hf",[a],b)),this.ea.Ic(2)}};function c6b(a,b,c){c=tK(bD(a.G,b),c);return c.length?(b=a.C,a=a.K.yb(c[0]),b.B.highlightDoco(b.C.B[a]||0,!0),!0):!1}r.dwa=function(a){z(a.B,function(a){y0(this,!0,a);this.O.add(a)},this)};r.ewa=function(a){z(a.B,function(a){y0(this,!1,a);this.O.remove(a)},this)};
function y0(a,b,c,d,e){c=w0(a,c);d=d||u0(a.D,a.F,c);e=e||t0(a.F,c);if(c&&d&&e){var f=bD(a.G,d);if(b){var h=f.B.Le(e.y,e.x)||new ag;h.add(c);Ly(f.B,e.y,e.x,h)}else(h=f.B.Le(e.y,e.x))&&h.remove(c);Ly(f.C,e.y,e.x,!0);f.F.mb()||f.F.start();a.D.getActiveGrid()&&(d=d==Pu(a.D),b?(a=a.B,(b=d?e:null)&&Gg(b,a.AK)&&a.B.add(c),a.dispatchEvent(new x0("Af",[c],b))):(a=a.B,(b=d?e:null)&&Gg(b,a.AK)&&a.B.remove(c),a.Wr==c&&(a.Wr=null),a.dispatchEvent(new x0("Jf",[c],b))))}else a.B.dispatchEvent("Lf")}
function w0(a,b){if(!b)return null;if(!a.T[b]){var c=a.K.Qc(b);c&&(a.T[b]=c)}return a.T[b]}r.rsb=function(){this.B.reset()};r.k_a=function(a){a=w0(this,a.B.length?a.B[0]:null);var b=t0(this.F,a);this.B.dispatchEvent(new x0("Ef",[a],b))};r.J_a=ba();r.o6a=function(){var a=this.X,b=this.C.B.hasPendingContent();wk(a,uk(a.Da,4,b))};r.T1a=function(a){this.Ha&&(a.D||this.B&&!this.B.Wr)&&this.Ha.C.setVisible(!0)};r.u4a=function(){this.ea.Ic(3)};
r.nsb=function(a){if(!o0(this.C)){var b=w0(this,a.B.length?a.B[0]:null),c=t0(this.F,b);b&&c?(this.kga=!0,d6b(this.B,b,c)):b||a.D?this.B.reset():b||this.ea.Ic(3)}};r.sWa=function(){this.kga=!1};r.dbb=function(){this.B.dispatchEvent("Gf")};r.fbb=function(){if(!this.R.isEmpty()&&!o0(this.C)){this.ea.Ic(3);var a=this.B,b=sv(Pu(this.D));Gg(a.mM,b)||!a.Wr&&!a.Dv&&Gg(a.AK,b)||(z0(a),a.dispatchEvent(new x0("Df",[],b)))}};
r.cbb=function(){var a=Pu(this.D);if(!o0(this.C)&&a){var b=bD(this.G,a),c=(a=sv(a))?tK(b,a):[];c.length&&(b=this.B,c=c[0],Gg(b.mM,a)?(z0(b),b.dispatchEvent(new x0("Bf",[],a))):b.dispatchEvent(new x0("Bf",[c],a)))}};r.abb=function(){o0(this.C)||this.B.reset()};r.qsb=function(){e6b(this.B)};r.bbb=function(){e6b(this.B)};
r.f5a=function(a){var b=a.ef;if(b&&b.B)if(W5b(b)){var c;c=b.getId();c=this.K.yb(new T5b(c));a="add_named_range"==a.type;if(!a||this.O.contains(c)){var d=b.Nb();b.jg()&&null!=d&&(d=$5b(this.D,d))&&y0(this,a,c,d,b.jc().Be())}}else this.B.dispatchEvent("Lf")};
r.obb=function(a){a=a.docos||[];Hb(a);for(var b=0;b<a.length;b++){var c=this.K.yb(new r0(a[b]));if(c){var d=w0(this,c),e;a:{e=this.G;if(d){var f=void 0;for(f in e.B){var h=e.B[f],k=M5b(h,d);if(k){e={Pa:h.rc(),XNa:k};break a}}}e=null}e?(y0(this,!1,c,e.Pa,e.XNa),y0(this,!0,c),this.B.dispatchEvent("Lf")):this.O.contains(c)&&y0(this,!0,c)}}};
r.ebb=function(a){var b=Pu(this.D);if(b){if((a=a.Sf)&&!lE(a)){var c=wv(b,a.y,a.x);a=c?c.Be():a}else a=null;b=bD(this.G,b);b=a?tK(b,a):[];c=this.B;c.B.clear();bg(c.B,b);c.AK=a;c.dispatchEvent(new x0("Cf",b,a))}};r.m9a=function(){if(!o0(this.C)){var a=this.B;if(a.Dv&&a.SS)a.SS=!1;else{var b=!a.Dv;z0(a);a.Dv=b;a.dispatchEvent("If")}}};r.k9a=function(){if(!o0(this.C)){var a=this.B;a.Dv||(z0(a),a.SS=!0,a.Dv=!0,a.dispatchEvent("If"))}};r.j9a=function(){if(!o0(this.C)){var a=this.B;a.Dv&&a.SS&&(z0(a),a.dispatchEvent("If"))}};
r.psb=function(a){a.stopPropagation()};r.STa=function(a){var b=w0(this,a);a=u0(this.D,this.F,b);if(!b||!a)return"";b=t0(this.F,b);a=tv(a,b).getDisplayValue();500<a.length&&(a=a.substring(0,499),a+="\u2026");return a};r.cWa=function(){var a;a=this.C;var b=a.B.getLinkedDoco();if(a=a.C.C[b]||null||"")(a=w0(this,a))?(b=t0(this.F,a),d6b(this.B,a,b)):Q.ew.Rb()};r.S4a=function(){var a=Pu(this.D);c6b(this,a,sv(a))};r.a5a=function(){f6b(this,!1)};r.b5a=function(){f6b(this,!0)};
function f6b(a,b){for(var c=g6b(a,b),d=eB(a.D),e=Pu(a.D),f=sv(e),h=bD(a.G,e),f=L5b(h,f,b),k=d;!f&&null!==k&&(k=c(k),e=k.rc(),h=bD(a.G,e),f=L5b(h,null,b),k=k.qf,k!=d););f&&null!==k&&(c=tK(h,f)[0],ty(a.D,k,v(a.ssb,a,e,c,f)))}function g6b(a,b){var c;c=b?v(a.D.yta,a.D):v(a.D.YZ,a.D);return function(a){return c(a,0,!0,!0)}}r.ssb=function(a,b,c){d6b(this.B,b,c);PA(a,c)};
r.V=function(){delete this.J;delete this.Ca;delete this.K;delete this.T;delete this.C;delete this.G;delete this.M;delete this.F;delete this.Ia;delete this.D;delete this.xa;J(this.X);delete this.X;J(this.R);delete this.R;J(this.B);delete this.B;a6b.P.V.call(this)};function x0(a,b,c){K.call(this,a);this.docos=b;this.G=b.length?b[0]:null;this.Rl=c||null}y(x0,K);function h6b(){L.call(this);this.B=new ag}y(h6b,L);r=h6b.prototype;r.AK=null;r.mM=null;r.Wr=null;r.Dv=!1;r.SS=!1;function d6b(a,b,c){z0(a);a.Wr=b;a.mM=c;a.dispatchEvent(new x0("Ff",[b],c))}r.Bt=g("Dv");function e6b(a){a.Dv||a.Wr||z0(a);a.dispatchEvent("Mf")}r.reset=function(){z0(this);this.dispatchEvent("Kf")};function z0(a){a.AK=null;a.B.clear();a.mM=null;a.Wr=null;a.Dv=!1;a.SS=!1}r.V=function(){delete this.AK;delete this.B;delete this.mM;delete this.Wr;h6b.P.V.call(this)};function i6b(a,b,c,d,e,f){IF.call(this,a,b,c,d,e,2,0,f)}y(i6b,IF);i6b.prototype.R=function(a){return oYa(this,a,"range-border cell-border waffle-docos-target-cell-border")};function j6b(a,b,c,d,e,f,h){L.call(this);this.D=a;this.xa=b;this.F=c;this.Ha=d;this.J=e;this.B=f;this.O=b.Ha;this.C=b.B;this.K=b.M;this.M=s0.getInstance();this.Ba=h||Hl();this.G=new ag;this.T=new ag;this.ea=new ag;this.R=new ag;this.X=new M(this);I(this,this.X);k6b(this);this.X.L(this.C,"Sa",this.wsb).L(this.B,"Cf",this.JXa).L(this.B,"Df",this.LXa).L(this.B,"Bf",this.IXa).L(this.B,"Ef",this.l_a).L(this.B,"Ff",this.tsb).L(this.B,"Mf",this.vsb).L(this.B,"Kf",this.usb).L(this.B,"Hf",this.I_a).L(this.B,
"Lf",this.Y7a).L(this.B,"Af",this.j_a).L(this.B,"Jf",this.m_a).L(this.B,"Gf",this.n_a).L(this.B,"If",this.t6a);l6b(this)}y(j6b,L);r=j6b.prototype;r.Tu=null;r.p9="none";r.p1=500;r.BU=!1;r.n_a=function(){A0(this)};r.j_a=function(a){var b=a.G;b&&m6b(this,[b],!0);n6b(this,a.G)};r.m_a=function(a){var b=a.G;b&&o6b(this,[b]);n6b(this,a.G)};function n6b(a,b){var c=u0(a.C,a.K,b);if(c){var d=bD(a.O,c),e=a.Ha,c=c.Nb(),d=N5b(d).length;K5b(J5b(e,c),d);ZJ(e)}else p6b(a)}r.t6a=function(){A0(this);this.B.Bt()&&q6b(this)};
r.LXa=function(){A0(this)};r.IXa=function(a){if(a.G){var b=a.G;this.BU=!0;a=this.D;b=this.M.yb(b);a.B.highlightDoco(a.C.B[b]||0,void 0);this.BU=!1}else A0(this)};r.vsb=function(){var a=this.B.Wr,b=this.G.isEmpty();this.B.Bt()?q6b(this):a?(r6b(this,[a]),b&&!this.G.isEmpty()&&(this.BU=!0,b=this.D,a=this.M.yb(a),b.B.highlightDoco(b.C.B[a]||0,void 0),this.BU=!1)):b||A0(this)};r.usb=function(){A0(this)};
function A0(a){a.G.clear();var b=a.D;b.B.flushDocoPositions(P5b(b,{}));b=a.D;b.B.highlightDoco(b.C.B[""]||0,void 0);R(a.J,!1);J(a.Tu);s6b(a);t6b(a);a.B.Bt()||u6b(a);v6b(a,a.B.Bt());l6b(a)}r.isEmpty=function(){return this.G.isEmpty()&&this.ea.isEmpty()&&this.T.isEmpty()&&this.R.isEmpty()};function l6b(a){var b=ny(a.F);b&&(a.p1=kSa(b.B)/2,a.D.setOption(Docos.OptionName.MAX_DOCO_HEIGHT,a.p1))}function t6b(a){wc(a.ea.fd());a.ea.clear()}function s6b(a){wc(a.T.fd());a.T.clear()}
function u6b(a){z(a.R.fd(),function(a){no(a,"waffle-docos-target-cell-header")});a.R.clear()}r.JXa=function(a){this.B.Wr||this.B.Bt()||(a=a.docos,a.length?r6b(this,a,!0):w6b(this,!1))};function r6b(a,b,c){o0(a.D)||o6b(a,dg(a.G,b).fd());m6b(a,b,c)}function q6b(a){var b=Pu(a.C);b&&(b=bD(a.O,b),r6b(a,N5b(b),!0),x6b(a),y6b(a))}r.tsb=function(a){z6b(this,a.G,a.Rl)};
function z6b(a,b,c,d){var e=u0(a.C,a.K,b);if(e){var f=e.Nb();if(A6b(a,b)){var h=B6b(a,c);Ey(Iz(a.C,f).D,v(e.Sq,e,h)).addCallback(function(){C6b(this,c)&&!h.equals(MA(e))?(TA(e,h),z6b(this,b,c,d)):(Uz(tv(e,c))&&NH(ny(this.F)).setVisible(!1),D6b(this,c),r6b(this,[b],!0),s6b(this),t6b(this),u6b(this),E6b(this,c),v6b(this,this.B.Bt()),d&&lk(function(){this.D.B.grabFocus()},0,this),this.dispatchEvent("zf"))},a)}else gK(a.C,f,v(function(){this.D.B.grabFocus();z6b(this,b,c,!0)},a))}else a.dispatchEvent("zf")}
function D6b(a,b){var c=Pu(a.C),d=ny(a.F);if(!a.BU&&c&&d){var e=d.B,d=d.C,f=OC(e,"waffle",!1,!1),h=212;if(!e.xb()){var k=Ml("docs-docos-activitybox");k&&No(k)&&(h+=f.right-Lo(k).left)}k=F6b(a,b);h=k.x-f.right+h;f=k.y-f.bottom+a.p1;if(!(0>=h&&0>=f)){d=d.B.Be();for(d=Tg(d.y,d.x,d.y,d.x);nSa(e,d).height<f;)d.height+=1;for(;nSa(e,d).width<h;)d.width+=1;e=d.height;d=d.width;UA(c,xLa(c,iA(c,LA(c),d,e)))}}}function C6b(a,b){var c=Pu(a.C);return DA(wy(c,"r"),b.y)&&DA(wy(c,"c"),b.x)}
function v6b(a,b){a.Ha.cU(b)}function B6b(a,b){return wv(Pu(a.C),b.y,b.x)||Ug(b)}
r.l_a=function(a){if(!this.B.Bt()&&(s6b(this),A6b(this,a.G)&&(w6b(this,!0),this.B.Wr!=a.G))){var b=this.M.yb(a.G),c=this.D;c.B.isDocoResolved(c.C.B[b]||0)?(b=a.Rl,a=ny(this.F),(c=Pu(this.C))&&a&&b&&(b=wv(c,b.y,b.x)||Ug(b),b=GX(a,b,"waffle-docos-target-cell-resolved-rect"),hE(MH(a),b,!0),b.setVisible(!0),this.T.add(b))):(c=a.Rl,a=ny(this.F),(b=Pu(this.C))&&a&&c&&(c=wv(b,c.y,c.x)||Ug(c),b=new i6b(b,a.G,a.B,a.C,new uE(c),this.Ba),hE(MH(a),b,!0),this.T.add(b),b.setVisible(!0)))}};
function G6b(a,b){b&&(lo(b,"waffle-docos-target-cell-header"),a.R.add(b))}function E6b(a,b){var c=ny(a.F),d=Pu(a.C);d&&c&&b&&(d=wv(d,b.y,b.x)||Ug(b),d=GX(c,d,"waffle-docos-target-cell-rect"),hE(MH(c),d,!0),a.ea.add(d),d.setVisible(!0),d.getElement()&&a.X.L(d.getElement(),["click","contextmenu","dblclick","mousedown","mouseup"],function(a){a.Sf=b;c.dispatchEvent(a)}))}function x6b(a){t6b(a);var b={};z(a.G.fd(),function(a){a=t0(this.K,a);var d=a.x+"-"+a.y;b[d]||(E6b(this,a),b[d]=!0)},a)}
function y6b(a){u6b(a);var b=Pu(a.C),c=ny(a.F);if(b&&c){var d=c.G,c=c.C,b=bD(a.O,b),e=c.Uf("r"),f=c.gg("r"),h=c.Uf("c"),k=c.gg("c");z(N5b(b),function(a){a=t0(this.K,a);a.x>=h&&a.x<=k&&G6b(this,d.B.getElement(eE(d,"ch-",null,aB(d.D,a.x))));a.y>=e&&a.y<=f&&G6b(this,d.B.getElement(eE(d,"rh-",$A(d.D,a.y),null)))},a)}}r.Y7a=function(){p6b(this)};function p6b(a){var b=nb(Zb(a.O.B),Number);z(b,function(a){var b=$5b(this.C,a);if(b){var e=bD(this.O,b),b=this.Ha,e=N5b(e).length;K5b(J5b(b,a),e);ZJ(b)}},a)}
r.I_a=function(a){if(a.G){var b=this.M.yb(a.G),c=this.D;a=F6b(this,a.Rl);a=u(a)?new Docos.Point(a.x,a.y):void 0;c.B.newDoco(b,a,void 0)}};
function m6b(a,b,c){for(var d={},e=[],f={},h=0;h<b.length;h++){var k=b[h],l=a.M.yb(k),m;m=a;var n=k;if(ny(m.F)&&A6b(m,n)){var q=t0(m.K,n);m=H6b(m,B6b(m,q))?m.B.Bt()||m.B.Wr==n||tb(m.B.B.fd(),n):!1}else m=!1;m?(m=t0(a.K,k),n=m=B6b(a,m),n=n.Ob()+"-"+n.Fc()+"-"+n.Ab()+"-"+n.Rc()+"-"+n.B+"-"+n.Bd,f[n]=f[n]||0,d[l]=F6b(a,m.Be(),f[n]),f[n]++,a.G.add(k)):e.push(k)}a.G.isEmpty()||w6b(a,!0);cc(d)||(b=a.D,b.B.updateDocoPositions(P5b(b,d)));o0(a.D)||o6b(a,e);if(c)for(c=a.G.fd(),d=0;d<c.length;d++){e=a;b=c[d];
f=void 0;a:switch(f=b,f.getType()){case "range":break a;case "workbook-range":break a;default:throw Error("Invalid doco with type: "+f.getType());}f=t0(e.K,f);f=F6b(e,f);l=ny(e.F);h=l.B;k=l.Ag;k=k.D(k.C()-1);m=Pu(e.C).O.y;l=l.C.gg("r");h=h.pf(new Ig(m,l),"r");h+=k;k=FC(ny(e.F).B,"c");f=h-(f.y-k);f<e.p1&&b&&(b=e.M.yb(b),e=e.D,e.B.setDocoMaxHeight(e.C.B[b]||0,125>f?125:f))}}
function o6b(a,b){var c=cg(a.G,b).fd();a.G.hc(c);c=nb(c,function(a){return this.M.yb(a)},a);c.length&&O5b(a.D,c);a.G.isEmpty()&&w6b(a,!1)}
function F6b(a,b,c){var d=ny(a.F),e=Pu(a.C),f=d.B,h=f.xb(),k=B6b(a,b),l=QC(f,k),m=c?15*c:0;c=h?l.left-m:l.right+m;var k=l.top+m,n=a.B.Bt();a=Gg(a.B.mM,b);var q=Uz(tv(e,b));n||a||!q?(b=k+125,0<b-kSa(f)&&(e=e.Oj("r")-1,f.im(b,"r","waffle")>=e&&(k-=50))):(a=NH(d),n=a.J,h2a(d,IA(e,b).Be()),e=a.O.height?a.Vb:0,b=a.R.height,d=Math.min(OVa.height,e+b),b&&(d=d+30+12+GE.top,d+=GE.bottom),e&&(d=d+12+GE.top,d+=GE.bottom),e=d,pE(a,n),k+=e);l=h?l.right+m+212:l.left-m-212;m=h?0>c-212:c+212>GC(f);e=h?l>GC(f):0>
l;m&&!e&&(c=l);return new N(h?HC(f,c,"c"):c,k)}function A6b(a,b){var c=u0(a.C,a.K,b),d=Pu(a.C);return!!c&&c==d}function H6b(a,b){if(!b)return!1;var c=ny(a.F).C,d=!1,e=b.Be();Gga(b,function(a,b){var k;if(k=a==e.y)k=null!=IH(c,new N(b,a));return k?d=!0:!1});return d}r.wsb=function(){k6b(this)};function k6b(a){var b=ny(a.F);b&&(a.Ba.appendChild(b.gO,a.J),a.D.setOption(Docos.OptionName.LAYOUT_RTL,b.B.xb()),a.D.setOption(Docos.OptionName.ANCHOR_DIV,a.J),a.D.B.renderAnchorSurface())}
function w6b(a,b){var c,d=a.J.style;c="";"opacity"in d?c=d.opacity:"MozOpacity"in d?c=d.MozOpacity:"filter"in d&&(d=d.filter.match(/alpha\(opacity=([\d.]+)\)/))&&(c=String(d[1]/100));c=""==c?c:Number(c);c=ra(c)?1:c;No(a.J)||(c=0);d=b&&1>c?"in":!b&&0<c?"out":"none";"none"==d?(J(a.Tu),R(a.J,b)):a.Tu&&1==a.Tu.Da&&a.p9==d||(J(a.Tu),R(a.J,!0),a.Tu=new Ft(a.J,c,"in"==d?1:0,250),a.p9=d,"out"==d&&$c(a.Tu,"finish",v(a.x0a,a)),a.Tu.play())}r.x0a=function(){A0(this);var a=ny(this.F);a&&BD(a)};
r.V=function(){delete this.F;delete this.J;delete this.M;delete this.D;delete this.G;delete this.B;delete this.O;delete this.Ba;delete this.p9;delete this.X;delete this.K;delete this.C;delete this.xa;J(this.Tu);delete this.Tu;t6b(this);s6b(this);u6b(this);j6b.P.V.call(this)};function I6b(a,b,c,d,e,f){G.call(this);this.M=a;this.T=u(b)?b:!0;this.O=u(c)?c:1;this.D=new GQ(v(this.OPa,this),d||1E3,e||6E4,f);I(this,this.D);this.G=new hj(void 0,this);this.B=null;this.J=[];this.F="DCS_Callback"+String(J6b++);this.K=this.C=null}y(I6b,G);var J6b=0;r=I6b.prototype;r.u8=function(){this.B=null;this.D.stop();this.G.hb(this.J)};
r.wqa=function(a){a instanceof ij||(a instanceof aS&&3==a.code?this.u8():(this.B=null,this.J.push(a instanceof Error?a.message:""),0<this.O--?this.D.start():this.G.Sd(this.J)))};r.Edb=function(){this.D.mb()||this.D.start();var a=new hj;mj(this.G,a);return a};
r.OPa=function(){if(this.T){this.C=new gW(this.M);this.C.jh=1E4;var a=v(this.u8,this);ga(this.F,a,void 0);this.K=this.C.send({callback:this.F},void 0,v(this.wqa,this))}else this.B&&this.B.cancel(),this.B=NWb(this.M,"dcs_main_js",{timeout:1E4}),jj(this.B,this.u8,this.wqa,this)};r.V=function(){this.B&&this.B.cancel();this.G.cancel();fa[this.F]&&(fa[this.F]=ia);this.C&&this.K&&this.C.cancel(this.K);I6b.P.V.call(this)};function K6b(){var a;a=""+('<div class="docs-docos-activitybox" role="dialog" aria-label="'+Jq("Comment stream box.")+'"><div class="docs-docos-activitybox-inner"></div></div>');return W(a)};function B0(a,b){ap.call(this,b);this.B=a}y(B0,ap);r=B0.prototype;r.t8=null;r.uP=null;r.iQ=null;r.Mn=null;r.Xna=!1;r.Na=function(){B0.P.Na.call(this);var a=this.$,b=mq(K6b,{},{},a);this.ma=b;jm(b,!0);this.uP=a.getElement("docs-docos-caret");this.t8=a.le("docs-docos-activitybox-inner",b);this.B&&(lo(b,"docos-enable-new-header"),lo(this.uP,"docos-enable-new-header"))};
r.Ea=function(){this.iQ=new Bn(this.getElement());this.iQ.Wk("close-box",27);this.Mn=new lp(this.getElement(),"toggle_display");np(this.Mn,!0);var a=this.Mn;mp(a);a.x0=!1;this.Mn.Dra=!1;T(this).L(this.iQ,"shortcut",this.A9a).L(this.Mn,"show",this.rgb).L(this.Mn,"hide",this.qgb).L(this.Mn,"beforeshow",this.pgb).L(this.Mn,"beforehide",this.ogb)};r.ib=g("t8");r.rgb=function(){R(this.uP,!0);this.dispatchEvent("show")};r.qgb=function(){R(this.uP,!1)};r.pgb=function(){return this.dispatchEvent("beforeshow")};
r.ogb=function(){return this.Xna?!1:this.dispatchEvent("hide")};r.setVisible=function(a){this.Mn.setVisible(a)};r.La=function(){return!!this.Mn&&this.Mn.La()};r.A9a=function(a){switch(a.C){case "close-box":this.setVisible(!1)}};r.V=function(){J(this.iQ);delete this.iQ;delete this.uP;delete this.t8;J(this.Mn);delete this.Mn;B0.P.V.call(this)};function L6b(a,b,c,d){L.call(this);this.D=c||new Il;this.B=a;this.M=!!b;this.C=new B0(this.B.isDocsStreamHeaderEnabled&&this.B.isDocsStreamHeaderEnabled(),this.D);this.U=new M(this);this.G=new nt(void 0,void 0,!0,zt.getInstance());this.F=d||Q.Ria;this.J=!1;this.K=qh(rh(),"docs-edll");this.B.onReady(v(this.wgb,this))}y(L6b,L);r=L6b.prototype;r.Mz=null;r.Yxa=!1;r.render=ba();
r.wgb=function(){var a=this.D.getElement("docs-docos-commentsbutton");this.Mz=zS(null);Wp(this.Mz,16);this.Mz.Oa(a);qh(rh(),"docosUnreadCommentsEnabled")&&(this.B.setListener(Docos.EventType.UNREAD_COMMENTS,this.Vgb,this),this.B.setOption(Docos.OptionName.ENABLE_UNREAD_COMMENTS,!0),Q.ew.$c(Vm,this.yLa,this));st(this.G,this.Mz,Q.ew,tt);Q.ew.$c(Vm,this.Dkb,this);this.C.render(a.parentNode.parentNode);R(this.C.getElement(),!1);Q.ew.Fa(!0);this.B.setOption(Docos.OptionName.PANE_DIV,this.C.ib());this.B.setOption(Docos.OptionName.PANE_KB_DIV,
this.C.getElement());this.B.setOption(Docos.OptionName.ENABLE_LAZY_LOADING,this.K);var b;this.K?(b=this.B.getLinkedDoco(),b=!!b&&(!this.B.hasDoco(b)||this.B.isDocoResolved(b)||!this.B.getDocoPosition(b))):b=!0;b?(this.B.renderPaneSurface(),this.J=!0):this.B.isLinkedDocoDeleted()&&(b=Zq("This comment has been deleted.","info",!0),Xq.getInstance().postMessage(b));this.B.setListener(Docos.OptionName.DIALOG_OPENED,v(this.lBa,this));this.B.setListener(Docos.OptionName.DIALOG_CLOSED,v(this.lBa,this));this.B.setOption(Docos.OptionName.SORT_PANE,
!0);this.B.setOption(Docos.OptionName.STREAM_BUTTON,a);Docos.EventType.CREATE_DRAFT&&(this.B.setListener(Docos.EventType.CREATE_DRAFT,this.cOa,this),this.F.$c(Tm,this.kBa,this),this.kBa(new Fpa("enabled",this.F.isEnabled(),!1)));this.M||this.B.setListener(Docos.EventType.NETWORK_ERROR,this.kgb,this);this.U.L(this.C,["show","hide"],this.Ueb)};r.lBa=function(a){a=a.args.shouldOverrideHide()&&a.type==Docos.OptionName.DIALOG_OPENED;this.C.Xna=a};
r.kBa=function(a){this.B.setOption(Docos.OptionName.ENABLE_COMMENT_BUTTON,a.newValue)};r.cOa=function(a){this.C.setVisible(!1);var b=a.args.isInstantDoco()?Q.zIa:this.F,c;if(a.args.isInstantDoco()){c=new Xm;var d=-1==a.args.getInstantDocoSpacerIndex();P(c,42,d?Q5b.uKa:Q5b.HOVER);c=Gn(Hn(new Fn,c),31).va()}b.Rb(a.args,c)};r.Dkb=function(){this.J||(this.B.renderPaneSurface(),this.J=!0);var a=this.C;a.Mn&&!sta(a.Mn)&&a.Mn.setVisible(!0)};
function M6b(a,b){if(0>b)throw Error("Number of unread comments cannot be negative");Qp(a.Mz,"docs-docos-commentsbutton-unread",0<b);var c=a.D.getElement("docs-docos-commentsbutton");a.D.Ig(c,String(b))}r.Vgb=function(){var a=this.B.getUnreadCommentsCount();M6b(this,a)};r.yLa=function(){M6b(this,0);this.B.ackUnreadComments()};
r.kgb=function(){if(!this.Yxa&&Q.ej.isEnabled()){if(this.B.hasPendingContent()){var a=Zq("Failed to post comment due to a network error.","warning",!0);Xq.getInstance().postMessage(a)}this.B.setOption(Docos.OptionName.FATAL_READONLY,!0);this.B.setOption(Docos.OptionName.SHOW_ERRORS,!0);Q.Ria.Fa(!1,"docos-fatal-reason");this.Yxa=!0}};r.Ueb=function(a){a="show"==a.type;this.B.isPaneSurfaceRendered()&&this.B.setOption(Docos.OptionName.SORT_PANE,!a);this.Mz.Ac(a);a?this.B.grabFocus():this.dispatchEvent("activity-box-closed")};
r.V=function(){J(this.Mz);delete this.Mz;J(this.U);delete this.U;J(this.C);delete this.C;J(this.G);delete this.G;delete this.B;L6b.P.V.call(this)};function N6b(){G.call(this)}y(N6b,ym);r=N6b.prototype;r.ZSa=function(){return I6b};r.sTa=function(){return L6b};r.pTa=function(){return a6b};r.qTa=function(){return h6b};r.rTa=function(){return j6b};Gm("docos",N6b);
